<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your A1dos Account</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="icon" type="image/x-icon" href="/AuthFaviconLight.png" id="favicon">
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3/build/jwt-decode.min.js"></script>
</head>

<script>
    function updateFavicon() {
    const favicon = document.getElementById("favicon");
    const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;
    favicon.href = isDarkMode ? "/AuthFaviconDark.png" : "/AuthFaviconLight.png";
}
    updateFavicon();
    window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", updateFavicon);
</script>

<body style="background-color: rgb(32, 32, 32);overflow: visible;">
    <a href="/index.html">
        <button id="hm7235897g7">Home</button>
    </a>
    <div id="api-status" class="para1">Checking Sign-in API status...</div>
        <script>
        function checkApiStatus() {
            fetch('https://a1dos-login.onrender.com/health')
            .then(response => response.json())
            .then(data => {
                const statusEl = document.getElementById('api-status');
                if (data.status === "ok") {
                statusEl.textContent = "Account API Status: Online (last checked: " + new Date(data.timestamp).toLocaleTimeString() + ")";
                statusEl.style.color = "green";
                } else {
                statusEl.textContent = "Account API Status: Offline";
                statusEl.style.color = "red";
                }
            })
            .catch(err => {
                const statusEl = document.getElementById('api-status');
                statusEl.textContent = "Account API Status: Offline";
                statusEl.style.color = "red";
                console.error("Error fetching API status:", err);
            });
        }
        
        checkApiStatus();
        setInterval(checkApiStatus, 30000);
        </script>

    <div id="w75891g7" style="display: none;">
        <img src="/error.png" alt="Error Icon" id="infoIcon">
        <h2 class="header3">Temporary Service Outage</h2>
        <p id="parg10351781">Our Google and some sign-in services are down. Please allow up to 1 week for our services to be back up. Thank you! <i>March 8, 7:31pm</i></p>
    </div>

    <div id="i51703n295b">
        <img src="/info.png" alt="Info Icon" id="infoIcon">
        <h2 class="header3">Verification in Progress</h2>
        <p id="parg10351781">Our Google OAuth screen is currently under verification and will not be publicly availible for up to 1 month. Only select users are allowed test access.</p>
    </div>

    <p id="message"></p>

    <h1 class="header1">Account Management</h1>
    
    <div id="av571v3">
        <h2 class="header2" style="margin-bottom: -0px;">Account Info: (A1dos Account)</h2>
        <img>
        <button style="background-color: transparent;border-style: none;margin-top: -6px;margin-left: 370px;" id="showForm">
            <img src="./edit.png" alt="Edit Icon" class="icon">
        </button>
        <div id="accountInfo"></div>
        <button id="logout-btn">Logout</button>
        <button id="google-link-btn" class="link">
            <p id="google-link-btn-text">Link Google Account</p>
            <img src="/googleLogo.png" alt="Google Icon" class="icon">
        </button>
        <p id="google-status"></p>
        <div id="about">
            <p>Linking your Google account will allow you to sync your Google Classroom assignments and Calendar tasks with STL. It will also sync your created tasks to your Google Calendar.</p>
        </div>
    </div>

    <div class="notification-settings">
        <p>Email Notifications</p>
        <label class="switch">
          <input type="checkbox" id="emailToggle">
          <span class="slider"></span>
        </label>
        <span id="toggleLabel">Enabled</span>
      </div>

      <div id="upgrd358725hg6">
        <h1 class="header2">Upgrade Account (Coming Soon)</h1>
        <p class="upgrd89129p">Upgrade now to unlock premium features and exclusive content.</p>
        <button id="upgrade-button">Upgrade Now</button>
        <button id="donateInstead">Donate Instead</button>
      </div>

      <script src="/redirect.js"></script>

      <style>
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.3);
                display: none;
                z-index: 9998;
                backdrop-filter: blur(8px);
                transition: opacity 0.4s ease, backdrop-filter 0.4s ease;
            }
      </style>

      <div id="overlay" class="overlay"></div>

      <div id="resetPswPopup" style="opacity: 0; transform: scale(0.95); transition: opacity 0.5s ease, transform 0.5s ease; display: none;z-index: 9999;">
        <p id="pswAlert"></p>
        <form id="passwordForm">
            <h1 class="header2" style="margin-left: -40px;">Reset Password</h1>
            <br>
            <input type="email" id="email" placeholder="Your Email" required />
            <br>
            <br>
            <button type="button" id="sendCodeBtn">Send Verification Code</button>
            <br>

            <br>
            <br>
            <div id="changePassword">
                <input type="text" id="verificationCode" placeholder="Enter Code" required />
                <br>
                <br>
                <input type="password" id="newPassword" placeholder="New Password" required />
                <br>
                <br>
                <button type="submit" id="submit">Change Password</button>
            </div>
        </form>
      </div>

      <div id="devicesListContainer">
        <h3>Signed-In Devices</h3>
        <button id="toggleDevicesBtn">Show Devices</button>
        <ul id="deviceList" style="display: none;"></ul>
      </div>

    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3/build/jwt-decode.min.js"></script>
    <script src="account.js"></script>
</body>
</html>